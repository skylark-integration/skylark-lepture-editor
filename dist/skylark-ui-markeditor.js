/**
 * skylark-ui-markeditor - The skylark markdown editor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-markeditor/
 * @license MIT
 */
!function(e,t){function r(e,t){if("."!==e[0])return e;var r=t.split("/"),n=e.split("/");r.pop();for(var o=0;o<n.length;o++)"."!=n[o]&&(".."==n[o]?r.pop():r.push(n[o]));return r.join("/")}var n=t.define,o=t.require,i="function"==typeof n&&n.amd,a=!i&&"undefined"!=typeof exports;if(!i&&!n){var l={};n=t.define=function(e,t,n){"function"==typeof n?(l[e]={factory:n,deps:t.map(function(t){return r(t,e)}),exports:null},o(e)):l[e]=n},o=t.require=function(e){if(!l.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=l[e];if(!t.exports){var r=[];t.deps.forEach(function(e){r.push(o(e))}),t.exports=t.factory.apply(window,r)}return t.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(e(n,o),!i){var s=o("skylark-langx/skylark");a?exports=s:t.skylarkjs=s}}(function(e,t){e("skylark-ui-markeditor/MarkEditor",["skylark-langx/skylark","skylark-langx/langx","skylark-utils-dom/browser","skylark-utils-dom/noder","skylark-utils-dom/eventer","skylark-utils-dom/finder","skylark-utils-dom/query","skylark-utils-md/Parser","skylark-ui-swt/ui","skylark-ui-swt/Widget"],function(e,t,r,n,o,i,a,l,s,c){function u(e){return e=M?e.replace("Ctrl","Cmd"):e.replace("Cmd","Ctrl")}function d(e,t){t=t||{};var r=document.createElement("a"),n=t.shortcut||q[e];return n&&(n=u(n),r.title=n,r.title=r.title.replace("Cmd","⌘"),M&&(r.title=r.title.replace("Alt","⌥"))),r.className=t.className||"editor-icon-"+e,r}function m(){return el=document.createElement("i"),el.className="separator",el.innerHTML="|",el}function f(e,t){t=t||e.getCursor("start");var r=e.getTokenAt(t);if(!r.type)return{};for(var n,o,i=r.type.split(" "),a={},l=0;l<i.length;l++)n=i[l],"strong"===n?a.bold=!0:"variable-2"===n?(o=e.getLine(t.line),/^\s*\d+\.\s/.test(o)?a["ordered-list"]=!0:a["unordered-list"]=!0):"atom"===n?a.quote=!0:"em"===n&&(a.italic=!0);return a}function g(e){var t=e.codemirror.getWrapperElement(),r=document,n=r.fullScreen||r.mozFullScreen||r.webkitIsFullScreen,o=function(){t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},i=function(){r.cancelFullScreen?r.cancelFullScreen():r.mozCancelFullScreen?r.mozCancelFullScreen():r.webkitCancelFullScreen&&r.webkitCancelFullScreen()};n?i&&i():o()}function h(e){T(e,"bold","**")}function p(e){T(e,"italic","*")}function k(e){T(e,"code","```\r\n","\r\n```")}function v(e){var t=e.codemirror;x(t,"quote")}function w(e){var t=e.codemirror;x(t,"unordered-list")}function b(e){var t=e.codemirror;x(t,"ordered-list")}function y(e){var t=e.codemirror,r=f(t);N(t,r.link,"[","](http://)")}function C(e){var t=e.codemirror,r=f(t);N(t,r.image,"![","](http://)")}function S(e){var t=e.codemirror;t.undo(),t.focus()}function L(e){var t=e.codemirror;t.redo(),t.focus()}function E(e){var t=e.toolbar.preview,r=e.constructor.markdown,n=e.codemirror,o=n.getWrapperElement(),i=o.lastChild;/editor-preview/.test(i.className)||(i=document.createElement("div"),i.className="editor-preview",o.appendChild(i)),/editor-preview-active/.test(i.className)?(i.className=i.className.replace(/\s*editor-preview-active\s*/g,""),t.className=t.className.replace(/\s*active\s*/g,"")):(setTimeout(function(){i.className+=" editor-preview-active"},1),t.className+=" active");var a=n.getValue();i.innerHTML=r(a)}function N(e,t,r,n){var o,i=e.getCursor("start"),a=e.getCursor("end");t?(o=e.getLine(i.line),r=o.slice(0,i.ch),n=o.slice(i.ch),e.setLine(i.line,r+n)):(o=e.getSelection(),e.replaceSelection(r+o+n),i.ch+=r.length,a.ch+=r.length),e.setSelection(i,a),e.focus()}function x(e,t){for(var r=f(e),n=e.getCursor("start"),o=e.getCursor("end"),i={quote:/^(\s*)\>\s+/,"unordered-list":/^(\s*)(\*|\-|\+)\s+/,"ordered-list":/^(\s*)\d+\.\s+/},a={quote:"> ","unordered-list":"* ","ordered-list":"1. "},l=n.line;l<=o.line;l++)!function(n){var o=e.getLine(n);o=r[t]?o.replace(i[t],"$1"):a[t]+o,e.setLine(n,o)}(l);e.focus()}function T(e,t,r,n){n="undefined"==typeof n?r:n;var o,i=e.codemirror,a=f(i),l=r,s=n,c=i.getCursor("start"),u=i.getCursor("end");a[t]?(o=i.getLine(c.line),l=o.slice(0,c.ch),s=o.slice(c.ch),startRegex=new RegExp("/^(.*)?(*|_){"+r.length+"}(S+.*)?$/","g"),l=l.replace(startRegex,"$1$3"),endRegex=new RegExp("/^(.*S+)?(*|_){"+n.length+"}(s+.*)?$/","g"),s=s.replace(endRegex,"$1$3"),c.ch-=r.length,u.ch-=n.length,i.setLine(c.line,l+s)):(o=i.getSelection(),i.replaceSelection(l+o+s),c.ch+=r.length,u.ch+=n.length),i.setSelection(c,u),i.focus()}function F(e){var t=/[a-zA-Z0-9_\u0392-\u03c9]+|[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af]+/g,r=e.match(t),n=0;if(null===r)return n;for(var o=0;o<r.length;o++)n+=r[o].charCodeAt(0)>=19968?r[o].length:1;return n}var M=/Mac/.test(navigator.platform),q={"Cmd-B":h,"Cmd-I":p,"Cmd-K":y,"Cmd-Alt-I":C,"Cmd-'":v,"Cmd-Alt-L":b,"Cmd-L":w},A=[{name:"bold",action:h},{name:"italic",action:p},{name:"code",action:k},"|",{name:"quote",action:v},{name:"unordered-list",action:w},{name:"ordered-list",action:b},"|",{name:"link",action:y},{name:"image",action:C},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:E},{name:"fullscreen",action:g}],I=s.MarkEditor=c.inherit({klassName:"MarkEditor",_construct:function(e){e=e||{},e.element&&(this.element=e.element),e.toolbar=e.toolbar||I.toolbar,e.hasOwnProperty("status")||(e.status=["lines","words","cursor"]),this.options=e,this.element&&this.render()},render:function(e){if(e||(e=this.element||document.getElementsByTagName("textarea")[0]),!this._rendered||this._rendered!==e){this.element=e;var t=this.options,r=this,n={};for(var o in q)!function(e){n[u(e)]=function(t){q[e](r)}}(o);n.Enter="newlineAndIndentContinueMarkdownList",n.Tab="tabAndIndentContinueMarkdownList",n["Shift-Tab"]="shiftTabAndIndentContinueMarkdownList",this.codemirror=CodeMirror.fromTextArea(e,{mode:"markdown",theme:"paper",tabSize:"2",indentWithTabs:!0,lineNumbers:!1,autofocus:!0,extraKeys:n}),t.toolbar!==!1&&this.createToolbar(),t.status!==!1&&this.createStatusbar(),this._rendered=this.element}},createToolbar:function(e){if(e=e||this.options.toolbar,e&&0!==e.length){var t=document.createElement("div");t.className="editor-toolbar";var r=this;r.toolbar={};for(var n=0;n<e.length;n++)!function(e){var n;n=e.name?d(e.name,e):"|"===e?m():d(e),e.action&&("function"==typeof e.action?n.onclick=function(t){e.action(r)}:"string"==typeof e.action&&(n.href=e.action,n.target="_blank")),r.toolbar[e.name||e]=n,t.appendChild(n)}(e[n]);var o=this.codemirror;o.on("cursorActivity",function(){var e=f(o);for(var t in r.toolbar)!function(t){var n=r.toolbar[t];e[t]?n.className+=" active":n.className=n.className.replace(/\s*active\s*/g,"")}(t)});var i=o.getWrapperElement();return i.parentNode.insertBefore(t,i),t}},createStatusbar:function(e){if(e=e||this.options.status,e&&0!==e.length){var t=document.createElement("div");t.className="editor-statusbar";for(var r,n=this.codemirror,o=0;o<e.length;o++)!function(e){var o=document.createElement("span");o.className=e,"words"===e?(o.innerHTML="0",n.on("update",function(){o.innerHTML=F(n.getValue())})):"lines"===e?(o.innerHTML="0",n.on("update",function(){o.innerHTML=n.lineCount()})):"cursor"===e&&(o.innerHTML="0:0",n.on("cursorActivity",function(){r=n.getCursor(),o.innerHTML=r.line+":"+r.ch})),t.appendChild(o)}(e[o]);var i=this.codemirror.getWrapperElement();return i.parentNode.insertBefore(t,i.nextSibling),t}},value:function(e){return e?(this.codemirror.getDoc().setValue(e),this):this.codemirror.getValue()},toggleBold:function(){h(this)},toggleItalic:function(){p(this)},toggleBlockquote:function(){v(this)},toggleUnOrderedList:function(){w(this)},toggleOrderedList:function(){b(this)},drawLink:function(){y(this)},drawImage:function(){C(this)},undo:function(){S(this)},redo:function(){L(this)},togglePreview:function(){E(this)},toggleFullScreen:function(){g(this)}});return I.toolbar=A,I.markdown=function(e){return l.parse(e)},I.toggleBold=h,I.toggleItalic=p,I.toggleBlockquote=v,I.toggleUnOrderedList=w,I.toggleOrderedList=b,I.drawLink=y,I.drawImage=C,I.undo=S,I.redo=L,I.togglePreview=E,I.toggleFullScreen=g,I}),e("skylark-ui-markeditor/main",["./MarkEditor"],function(e){return e}),e("skylark-ui-markeditor",["skylark-ui-markeditor/main"],function(e){return e})},this);
//# sourceMappingURL=sourcemaps/skylark-ui-markeditor.js.map
